<!--README-->
<!--Please read comments in code-->

<!DOCTYPE html>
<html lang="sk">
<head>
    <title>Simple Mail Package Example</title>
    <!--    Step: 1.-->
    <!--    Add SITE_KEY in the link after "render="-->
    <!--    <script src="https://www.google.com/recaptcha/api.js?render=SITE_KEY"></script>-->
    <script src="https://www.google.com/recaptcha/api.js?render=6LcGKKoZAAAAAC_m382ekbY3LnPxqbC6977OzfXF"></script>
</head>
<body>
<!--Step: 2.-->
<!--    Action defines the entry point of mail sending-->
<form action="email.php" method="POST" id="contact-form" class="base-contact-form">
    <input type="text" name="contact_name" placeholder="Meno a priezvisko *" required="">
    <input type="text" name="contact_subject" placeholder="Predmet *" required="">
    <input type="text" name="contact_phone" placeholder="Telefónne číslo">
    <input type="email" name="contact_email" placeholder="Email *" required="">
    <textarea name="contact_message" placeholder="Správa *" required=""></textarea>
    <span>Polia označené * sú povinné</span>
    <button class="btn" type="submit">
        Odoslať
        <img src="http://demo.euro3.sk/resources/img/svg/arrow.svg" alt="euro3trade-arrow">
    </button>
</form>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>

    $(document).ready(function () {
        let form = $('#contact-form');

        // Step: 3.
        // insert SITE_KEY too
        const SITE_KEY = '6LcGKKoZAAAAAC_m382ekbY3LnPxqbC6977OzfXF';
        const CAPTCHA_ACTION = 'submit';
        const REQUEST_URL = form.attr('action');

        let requestData =  {};

        form.on('submit',function (e) {
            e.preventDefault();
            requestData =  {
                'contact_name': $('input[name="contact_name"]').val(),
                'contact_subject': $('input[name="contact_subject"]').val(),
                'contact_phone': $('input[name="contact_phone"]').val(),
                'contact_email': $('input[name="contact_email"]').val(),
                'contact_message': $('textarea[name="contact_message"]').val(),
                '_locale' : 'sk' // locale can be changed
            };
            grecaptcha.ready(function() {
                grecaptcha.execute(SITE_KEY, {action: CAPTCHA_ACTION}).then(function(token) {
                    requestData['g-recaptcha-response'] = token;
                    // console.log(requestData)
                    makeRequest();
                });
            });

        });

        function makeRequest() {
            $.ajax( {
                url : REQUEST_URL,
                data :  requestData,
                method: $(form).attr('method')
            } )
             .done(function(data, textStatus, jqXHR) {
                 if (data.status === true) {
                     actionOnSuccess();
                     form[0].reset();
                 }
                 if (data.status === false) {
                     actionOnUnSuccess();
                 }
             })
             .fail(function(data, textStatus, jqXHR) {
                 actionOnFail();
             })
             .always(function(data, textStatus, jqXHR) {
                 actionAfterXhrRequest()
             });
        }

        function actionOnSuccess() {
            // make some animation atc. if submit is successfully sent ...
        }

        function actionOnUnSuccess() {
            // make some animation atc. if submit was not sent ...
        }

        function actionOnFail() {
            // make some animation atc. if submit failed ...
        }

        function actionAfterXhrRequest() { // this always runs, no matter if succeeded or failed
            // this block always run if request ended ...
        }


    });


</script>
</body>
</html>